/*! echo-js v1.7.3 | (c) 2016 @toddmotto | https://github.com/toddmotto/echo */
(function(e,t){if(typeof define==="function"&&define.amd){define(function(){return t(e)})}else if(typeof exports==="object"){module.exports=t}else{e.echo=t(e)}})(this,function(e){"use strict";var t={};var n=function(){};var r,o,i,a,c;var l=function(e){return e.offsetParent===null};var s=function(e,t){if(l(e)){return false}var n=e.getBoundingClientRect();return n.right>=t.l&&n.bottom>=t.t&&n.left<=t.r&&n.top<=t.b};var u=function(){if(!a&&!!o){return}clearTimeout(o);o=setTimeout(function(){t.render();o=null},i)};t.init=function(o){o=o||{};var l=o.offset||0;var s=o.offsetVertical||l;var d=o.offsetHorizontal||l;var f=function(e,t){return parseInt(e||t,10)};r={t:f(o.offsetTop,s),b:f(o.offsetBottom,s),l:f(o.offsetLeft,d),r:f(o.offsetRight,d)};i=f(o.throttle,250);a=o.debounce!==false;c=!!o.unload;n=o.callback||n;t.render();if(document.addEventListener){e.addEventListener("scroll",u,false);e.addEventListener("load",u,false)}else{e.attachEvent("onscroll",u);e.attachEvent("onload",u)}};t.render=function(){var o=document.querySelectorAll("img[data-echo], [data-echo-background]");var i=o.length;var a,l;var u={l:0-r.l,t:0-r.t,b:(e.innerHeight||document.documentElement.clientHeight)+r.b,r:(e.innerWidth||document.documentElement.clientWidth)+r.r};for(var d=0;d<i;d++){l=o[d];if(s(l,u)){if(c){l.setAttribute("data-echo-placeholder",l.src)}if(l.getAttribute("data-echo-background")!==null){l.style.backgroundImage="url("+l.getAttribute("data-echo-background")+")"}else{l.src=l.getAttribute("data-echo")}if(!c){l.removeAttribute("data-echo");l.removeAttribute("data-echo-background")}n(l,"load")}else if(c&&!!(a=l.getAttribute("data-echo-placeholder"))){if(l.getAttribute("data-echo-background")!==null){l.style.backgroundImage="url("+a+")"}else{l.src=a}l.removeAttribute("data-echo-placeholder");n(l,"unload")}}if(!i){t.detach()}};t.detach=function(){if(document.removeEventListener){e.removeEventListener("scroll",u)}else{e.detachEvent("onscroll",u)}clearTimeout(o)};return t});function deepCopy(e,t){var e=e||{};for(var n in t){if(typeof t[n]==="object"){e[n]=t[n].constructor===Array?[]:{};deepCopy(t[n],e[n])}else{e[n]=t[n]}}return e}function debounce(e,t,n){var r=null;return function(){var o=arguments;if(r){clearTimeout(r)}r=setTimeout(()=>{e.apply(n,o)},t)}}var JELON=window.JELON||{};JELON=deepCopy(JELON,{name:"JELON",version:"0.0.2",db:[],init:function(){this.toggleMenu();this.backToTop();echo.init({offset:50,throttle:250,unload:false,callback:function(e,t){console.log(e,"has been",t+"ed")}});this.initSearch();this.initImgPreviewer();this.initTocTitle()},$:function(e){return/^(\[object HTML)[a-zA-Z]*(Element\])$/.test(Object.prototype.toString.call(e))?e:document.getElementById(e)},toggleMenu:function(){var e=this,t=e.$(e.name+"__menu");e.$(e.name+"__btnDropNav").onclick=function(){if(t.className.indexOf("hidden")===-1){t.className+=" hidden"}else{t.className=t.className.replace(/\s*hidden\s*/,"")}}},backToTop:function(){var e=this;if(typeof e.$(e.name+"__backToTop")==="undefined")return;window.onscroll=window.onresize=function(){if(document.documentElement.scrollTop+document.body.scrollTop>0){e.$(e.name+"__backToTop").style.display="block"}else{e.$(e.name+"__backToTop").style.display="none"}};e.$(e.name+"__backToTop").onclick=function(){var e=setInterval(t,10);function t(){if(document.documentElement.scrollTop+document.body.scrollTop<1){clearInterval(e)}else{document.documentElement.scrollTop/=1.1;document.body.scrollTop/=1.1}}}},initSearch:function(){var e=this;if(e.$("searchKeyword")){e.$("searchKeyword").onkeyup=debounce(function(){e.startSearch()},500,e)}if(e.$("searchButton")){e.$("searchButton").onclick=function(){e.startSearch()}}},renderSearchResult:function(e,t,n){var r=this;var o=r.$("searchResultList");var i=r.$("searchResultTotal");var a=e.filter(e=>e.title.toLowerCase().includes(t.toLowerCase()));if(!a.length){o.innerHTML='<p class="search-no-result">'+(n?"拼命加载中...":"暂无数据")+"</p>";i.innerHTML="";return}var c=a.map(e=>['<li class="search-result-item">','<a target="_blank" href="'+"/posts/"+e.slug+'" class="search-result-item-title">'+e.title+"</a>",'<p class="search-result-item-desc">'+(e.blogexcerpt||e.title)+"</p>","</li>"].join(""));o.innerHTML=c.join("");i.innerHTML=c.length+" 条数据"},startSearch:function(){var e=this;var t=e.$("searchResultBox");var n=(e.$("searchKeyword").value||"").trim();if(n){t.setAttribute("class","search-result-box show");if(!e.db.length){e.renderSearchResult([],n,true);fetch("/db.json").then(e=>e.json()).then(t=>{e.db=t.models&&t.models.Post||[];e.renderSearchResult(e.db,n)}).catch(()=>{e.renderSearchResult(e.db,n)});return}this.renderSearchResult(e.db,n)}else{t.setAttribute("class","search-result-box")}},initImgPreviewer:function(){var e=this;var t=e.$(e.name+"__articlePostContent");var n=t&&t.getElementsByTagName("img");if(t&&n.length){t.addEventListener("click",function(t){e.handleImgPreview(t)},false)}},handleImgPreview:function(e){var t=e.target;if(t.nodeName.toUpperCase()==="IMG"){this.createImgPreviewer(t.src);this.onRemoveImgPreviewer()}},createImgPreviewer:function(e){var t=document.createElement("div");var n=document.createElement("img");t.id=this.name+"__imgPreviewer";t.style=["position: fixed","display: flex","top: 0","right: 0","bottom: 0","left: 0","width: 100%","height: 100%","align-items: center","background-color: rgba(30, 30, 30, .9)","transition-duration: inherit","transition-property: opacity","transition-timing-function: cubic-bezier(.47,0,.74,.71)","z-index: 10000","cursor: zoom-out"].join(";");n.src=e;n.alt="预览";n.style=["margin: 0 auto","max-width: 98%","max-height: 98%","transform: scale(1, 1)","z-index: 10001"].join(";");t.appendChild(n);document.body.appendChild(t)},onRemoveImgPreviewer:function(){var e=this.$(this.name+"__imgPreviewer");if(e){e.onclick=function(){document.body.removeChild(e)}}},initTocTitle:function(){var e=this;var t=e.$(e.name+"__articlePostContent");if(!t)return;var n=t.getElementsByClassName("toc")[0];if(!n)return;var r=document.createElement("div");var o=document.createElement("span");r.className="toc-title";r.innerText="本文目录";o.innerText="（点击收起）";o.className="toc-collapse-text";o.style.float="right";if(n.getElementsByTagName("ul")[0]){n.getElementsByTagName("ul")[0].style.display="none"}o.onclick=function(){var e=n.getElementsByTagName("ul")[0];if(e){e.style.display=e.style.display==="none"?"block":"none";o.innerText=e.style.display==="none"?"（点击展开）":"（点击收起）"}};r.appendChild(o);n.insertBefore(r,n.firstChild)}});JELON.init();